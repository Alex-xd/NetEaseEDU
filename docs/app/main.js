define(["jquery","funcTpl","api/api.config","js.cookie","juicer"],function(e,t,o,n){var i={init:function(){i.toptipsControl(),i.loginControl(),i.carousel(),i.courseTabSwitch(),i.pagination(),i.getHottestCourse(),i.getIntroVideo()},toptipsControl:function(){var t=e("#J_top-tips");"true"!==n.get("toptipDismissed",{path:"/"})&&t.fadeIn(),e("#J_top-tips-dismiss").on("click",function(){n.set("toptipDismissed","true",{expires:7,path:"/"}),t.fadeOut()})},loginControl:function(){function t(){u.userName=e("#J_uid").val().trim(),u.password=e("#J_pwd").val(),u.userName&&u.password&&(c.html("正在登录..").attr("disabled","true"),e.get(o.login,u,function(t){if(0==t){n.set("loginSuc","true",{path:"/"}),c.html("登录成功");var o=e.Deferred();e.when(i._follow(r,o)).done(function(){a.hide(),s.hide()})}else alert("用户密码错误,请重新输入"),c.html("登录").removeAttr("disabled")}))}var r=e("#J_header-left-follow-btn"),a=e("#J_popup-login"),c=e("#J_submit"),s=e("#J_popup-wrap"),u={userName:"",password:""};r.on("click",function(){n.remove("loginSuc",{path:"/"}),"true"!==n.get("loginSuc",{path:"/"})&&(s.show(),a.show().css("top","+=30").animate({top:"-=30px",opacity:"1"},500))}),c.on("click",t),document.onkeydown=function(e){e=e?e:window.event;var o=e.which?e.which:e.keyCode;13==o&&t()},e("#J_close-popup-login").on("click",function(){s.hide(),a.hide()})},_follow:function(t,i){var r=e("#J_fans");return e.get(o.changeFollowState,function(e){if(1==e){n.set("followSuc","true",{path:"/"}),t.hide(),t.next().show();var o=r.html();o++,r.html(o),i.resolve()}}),i},carousel:function(){function t(){c=setInterval(function(){o(a),a++,a>2&&(a=0)},5e3)}function o(e){i.fadeOut(),i.eq(e).fadeIn(),r.removeClass("on"),r.eq(e).addClass("on")}var n=e("#J_banner"),i=e(".J_carousel-imgs"),r=e("#J_banner-dots span"),a=1,c=null;n.on("mouseover",function(){clearInterval(c)}),n.on("mouseout",function(){t()}),r.on("click",function(){var t=e(this).attr("data-id");o(t)}),t()},courseTabSwitch:function(){var t=e("#J_course-selectTab a:first"),o=t.next();t.on("click",function(){var n=e.Deferred();e.when(i._getCourseCard(0,20,t.attr("data-type"),n)).done(function(){o.removeClass("selected"),t.addClass("selected")})}),o.on("click",function(){var n=e.Deferred();e.when(i._getCourseCard(0,20,o.attr("data-type"),n)).done(function(){t.removeClass("selected"),o.addClass("selected")})}),t.trigger("click")},_getCourseCard:function(t,n,i,r){e(window).width()<1206&&(n=15);var a={pageNo:t,psize:n,type:i},c=e("#J_course-list");return c.html("课程列表加载中..."),e.get(o.getCoures,a,function(t){var o={};t=JSON.parse(t),o.list=t.list,c.html("");var n=juicer(e("#courseTpl").html(),o);c.html(n),e("#J_paging-next").data("rsp",t),r.resolve()}),r},pagination:function(){function t(t){var n=e("#J_course-selectTab a.selected").attr("data-type"),r=e.Deferred();e.when(i._getCourseCard(t,20,n,r)).done(function(){o.removeClass("on"),o.eq(t-1).addClass("on")})}var o=e(".course-paging-num"),n=e("#J_paging-next"),r=e("#J_paging-prev");o.on("click",function(){t(e(this).html())}),n.on("click",function(){e(".course-paging-num.on").next().trigger("click")}),r.on("click",function(){e(".course-paging-num.on").prev().trigger("click")})},getHottestCourse:function(){e.get(o.getHotcoures,function(t){var o={},n=e("#juicer-hottest-wrapper");t=JSON.parse(t),o.list=t,n.html("");var i=juicer(e("#sidebarTpl").html(),o);n.html(i);var r=n.offset().top,a=r,c=setInterval(function(){n.animate({top:"-=71px"},500),a-=71,r-a>639&&(n.animate({top:0},1500),a=r)},5e3);n.on("mouseover",function(){clearInterval(c)}),n.on("mouseout",function(){c=setInterval(function(){n.animate({top:"-=71px"},500),a-=71,r-a>639&&(n.animate({top:0},1500),a=r)},5e3)})})},getIntroVideo:function(){var t=e("#J_sidebar-org-video"),o=e("#J_popup-video"),n=o.find("video"),i=e("#J_popup-wrap");t.on("click",function(){o.fadeIn(1e3),n.attr("src","http://mov.bn.netease.com/open-movie/nos/mp4/2014/12/30/SADQ86F5S_shd.mp4"),i.show()}),e("#J_close-popup-video").on("click",function(){n.attr("src",""),o.hide(),i.hide()})}};i.init()});