require(["jquery","funcTpl","api/api.config","js.cookie","jquery.md5","Juicer"],function(o,t,n,e){var i={init:function(){i.toptipsControl.init(),i.followControl.init(),i.loginControl.init();var t=o.Deferred();o.when(i.getCourseCard(1,20,10,t)).done(i.loadBanners),i.courseTabSwitch(),i.getHottestCourse(),i.getIntroVideo(),i.carousel()},dom:{$login:o("#J_popup-login"),$submit:o("#J_submit"),$popupWrap:o("#J_popup-wrap"),$fans_count:o("#J_fans"),$followBtn:o("#J_header-left-follow-btn"),$unfollowBtn:o("#J_unfollowBtn")},loadBanners:function(){var t=o(".lz-load");t.each(function(){o(this).attr("src",o(this).attr("lz-src"))})},toptipsControl:{init:function(){var t=o("#J_top-tips");"true"!==e.get("toptipDismissed",{path:"/"})&&t.fadeIn(),o("#J_top-tips-dismiss").on("click",function(){e.set("toptipDismissed","true",{expires:7,path:"/"}),t.fadeOut()})}},loginControl:{init:function(){var t=this,n=i.dom;n.$submit.on("click",t._login),document.onkeydown=function(o){o=o?o:window.event;var n=o.which?o.which:o.keyCode;13===n&&t._login()},o("#J_close-popup-login").on("click",function(){n.$popupWrap.hide(),n.$login.hide()})},_login:function(){var t=i.dom,a={userName:"",password:""};a.userName=o.md5(o("#J_uid").val().trim()),a.password=o.md5(o("#J_pwd").val()),a.userName&&a.password&&(t.$submit.html("正在登录..").attr("disabled","true"),o.get(n.login,a,function(o){1==o?(e.set("loginSuc","true",{path:"/"}),t.$submit.html("登录成功"),i.followControl._follow()):(alert("用户密码错误,请重新输入"),t.$submit.html("登录").removeAttr("disabled"))}))}},followControl:{init:function(){var o=this,t=i.dom;"true"===e.get("followSuc",{path:"/"})&&(t.$followBtn.hide(),t.$followBtn.next().show()),t.$followBtn.on("click",function(){"true"!==e.get("loginSuc",{path:"/"})?(t.$popupWrap.show(),t.$login.show().css("top","+=30").animate({top:"-=30px",opacity:"1"},500)):o._follow()}),t.$unfollowBtn.on("click",function(){o._unfollow()})},_follow:function(){var t=i.dom;o.get(n.changeFollowState,function(n){if(1==n){e.set("followSuc","true",{path:"/"}),t.$login.hide(),t.$popupWrap.hide(),t.$followBtn.hide(),t.$followBtn.next().show();var i=parseInt(t.$fans_count.html());t.$fans_count.html(i+1),o("#J_popUpTips").html("关注成功").fadeIn().fadeOut()}})},_unfollow:function(){var t=i.dom;e.remove("followSuc",{path:"/"}),t.$followBtn.show(),t.$followBtn.next().hide();var n=parseInt(t.$fans_count.html());t.$fans_count.html(n-1),o("#J_popUpTips").html("您已取消关注").fadeIn().fadeOut()}},carousel:function(){function t(){l=setInterval(function(){n(r),r++,r>2&&(r=0)},5e3)}function n(o){i.fadeOut(),i.eq(o).fadeIn(),a.removeClass("on"),a.eq(o).addClass("on")}var e=o("#J_banner"),i=o(".J_carousel-imgs"),a=o("#J_banner-dots span"),r=1,l=null;e.on("mouseover",function(){clearInterval(l)}),e.on("mouseout",function(){t()}),a.on("click",function(){var t=o(this).attr("data-id");n(t)}),t()},courseTabSwitch:function(){var t=o("#J_course-selectTab a:first"),n=t.next();t.on("click",function(){var e=o.Deferred();o.when(i.getCourseCard(0,20,t.attr("data-type"),e)).done(function(){n.removeClass("selected"),t.addClass("selected")})}),n.on("click",function(){var e=o.Deferred();o.when(i.getCourseCard(0,20,n.attr("data-type"),e)).done(function(){t.removeClass("selected"),n.addClass("selected")})})},getCourseCard:function(t,e,a,r){o(window).width()<1206&&(e=15);var l={pageNo:t,psize:e,type:a},c=o("#J_course-list");return c.html("课程列表加载中..."),o.get(n.getCoures,l,function(t){var n={};t=JSON.parse(t),n.list=t.list,c.html("");var e=juicer(o("#courseTpl").html(),n);c.html(e),i.paginate(t.pagination),r&&r.resolve()}),r},paginate:function(t){function n(){var n,e=o("#J_numWrap");try{e.html("");for(var i=1;i<=t.totlePageCount;i++)n=e.html()+'<a href="javascript:;" class="course-paging-num">'+i+"</a>",e.html(n);e.html(n);var a=o(".course-paging-num");a.removeClass("on"),a.eq(t.pageIndex-1).addClass("on")}catch(r){throw new Error(r.message+"   可能的原因:data.totlePageCount不存在,请检查json返回数据。")}}function e(n){var e=o("#J_course-selectTab a.selected").attr("data-type");n>4&&console.error("此处后台接口有问题,超过第四页以后返回的数据都是相同的,但页码永远停留在第4页"),i.getCourseCard(n,t.pageSize,e)}n();var a=o("#J_paging-next"),r=o("#J_paging-prev"),l=o(".course-paging-num");l.on("click",function(){e(o(this).html())}),a.on("click",function(){o(".course-paging-num.on").next().trigger("click")}),r.on("click",function(){o(".course-paging-num.on").prev().trigger("click")})},pagination:function(){function t(t){var e=o("#J_course-selectTab a.selected").attr("data-type"),a=o.Deferred();o.when(i._getCourseCard(t,20,e,a)).done(function(){n.removeClass("on"),n.eq(t-1).addClass("on")})}var n=o(".course-paging-num"),e=o("#J_paging-next"),a=o("#J_paging-prev");n.on("click",function(){t(o(this).html())}),e.on("click",function(){o(".course-paging-num.on").next().trigger("click")}),a.on("click",function(){o(".course-paging-num.on").prev().trigger("click")})},getHottestCourse:function(){o.get(n.getHotcoures,function(t){var n={},e=o("#juicer-hottest-wrapper");t=JSON.parse(t),n.list=t,e.html("");var i=juicer(o("#sidebarTpl").html(),n);e.html(i);var a=e.offset().top,r=a,l=setInterval(function(){e.animate({top:"-=71px"},500),r-=71,a-r>639&&(e.animate({top:0},1500),r=a)},5e3);e.on("mouseover",function(){clearInterval(l)}),e.on("mouseout",function(){l=setInterval(function(){e.animate({top:"-=71px"},500),r-=71,a-r>639&&(e.animate({top:0},1500),r=a)},5e3)})})},getIntroVideo:function(){var t=o("#J_sidebar-org-video"),n=o("#J_popup-video"),e=n.find("video"),i=o("#J_popup-wrap");t.on("click",function(){n.fadeIn(1e3),e.attr("src","http://mov.bn.netease.com/open-movie/nos/mp4/2014/12/30/SADQ86F5S_shd.mp4"),i.show()}),o("#J_close-popup-video").on("click",function(){e.attr("src",""),n.hide(),i.hide()})}};i.init()});